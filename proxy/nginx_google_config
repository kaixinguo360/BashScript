proxy_cache_path /var/nginx/cache/TMP_SERVER_NAME  levels=1:2   keys_zone=one:10m max_size=10g;
proxy_cache_key "$host$request_uri";

upstream target {
    server TMP_IP1:80 max_fails=3;
    server TMP_IP2:80 max_fails=3;
    server TMP_IP3:80 max_fails=3;
    server TMP_IP4:80 max_fails=3;
    server TMP_IP5:80 max_fails=3;
}

server {
    listen 80;
    server_name TMP_SERVER_NAME;
    rewrite ^(.*) https://TMP_SERVER_NAME$1 permanent;
}

server {
    listen 443;
    server_name TMP_SERVER_NAME
    ssl on;
    ssl_certificate /etc/nginx/ssl/TMP_SERVER_NAME.cer;
    ssl_certificate_key /etc/nginx/ssl/TMP_SERVER_NAME.key;
    
    location / {
        proxy_redirect off;
        proxy_cookie_domain google.com TMP_SERVER_NAME 
        proxy_pass https://www.google.com;
        proxy_connect_timeout 60s;
        proxy_read_timeout 5400s;
        proxy_send_timeout 5400s;

        proxy_set_header Host "www.google.com";
        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Referer https://www.google.com;
        proxy_set_header Accept-Encoding "";
        proxy_set_header X-Real-IP $remote_addr; 
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; 
        proxy_set_header X-Forwarded-Proto https;
        proxy_set_header Accept-Language "zh-CN";
        proxy_set_header Cookie "PREF=ID=047808f19f6de346:U=0f62f33dd8549d11:FF=2:LD=en-US:NW=1:TM=1325338577:LM=1332142444:GM=1:SG=2:S=rE0SyJh2W1IQ-Maw";

        subs_filter https://www.google.com.hk TMP_SERVER_NAME;
        subs_filter https://www.google.com TMP_SERVER_NAME;
        #subs_filter_types text/css text/xml text/javascript;

        sub_filter_once off; 
    }
}
