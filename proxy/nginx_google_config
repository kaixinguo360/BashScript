upstream google {
        server 172.217.7.196:80 max_fails=3;
        server 172.217.7.228:80 max_fails=3;
        server 172.217.12.228:80 max_fails=3;
        server 216.58.218.228:80 max_fails=3;
        server 216.58.217.100:80 max_fails=3;
}

server {
        listen 80;
        server_name api.kaixinguo.site;
        rewrite ^(.*) https://api.kaixinguo.site$1 permanent;
}

server {
    listen 443;
    server_name api.kaixinguo.site;
    #ssl on;
    ssl_certificate /etc/nginx/ssl/api.kaixinguo.site.cer;
    ssl_certificate_key /etc/nginx/ssl/api.kaixinguo.site.key;
    
    location / {
        proxy_redirect off;
        proxy_cookie_domain google.com api.kaixinguo.site; 
        proxy_pass https://www.google.com;
        proxy_connect_timeout 60s;
        proxy_read_timeout 5400s;
        proxy_send_timeout 5400s;
    
        proxy_set_header Host "www.google.com";
        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Referer https://www.google.com;
        proxy_set_header Accept-Encoding "";
        proxy_set_header X-Real-IP $remote_addr; 
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; 
        proxy_set_header X-Forwarded-Proto https;
        proxy_set_header Accept-Language "zh-CN";
        proxy_set_header Cookie "PREF=ID=047808f19f6de346:U=0f62f33dd8549d11:FF=2:LD=en-US:NW=1:TM=1325338577:LM=1332142444:GM=1:SG=2:S=rE0SyJh2W1IQ-Maw";
    
        subs_filter www.google.com.hk api.kaixinguo.site;
        subs_filter www.google.com api.kaixinguo.site;
        #subs_filter_types text/css text/xml text/javascript;
    
        sub_filter_once off; 
    }
        
    #location / {
    #    proxy_cache one;
    #    proxy_cache_valid  200 302 1h;
    #    proxy_cache_valid  404 1m;
    #    proxy_redirect https://www.google.com/ /;
    #    proxy_cookie_domain google.com google.kaixinguo.site;
    #    proxy_pass http://target;
    #    proxy_set_header Host "www.google.com";
    #    proxy_set_header Accept-Encoding "";
    #    proxy_set_header User-Agent $http_user_agent;
    #    proxy_set_header Accept-Language "zh-CN";
    #    proxy_set_header Cookie "PREF=ID=047808f19f6de346:U=0f62f33dd8549d11:FF=2:LD=en-US:NW=1:TM=1325338577:LM=1332142444:GM=1:SG=2:S=rE0SyJh2W1IQ-Maw";
    #    sub_filter www.google.com google.kaixinguo.site ;
    #    sub_filter_once off;
    #}
}

